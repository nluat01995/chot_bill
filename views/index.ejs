<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%=title%></title>
    <!-- Link thư viện Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Link CSS tùy chỉnh -->
    <!-- <link href="styles.css" rel="stylesheet" /> -->
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="/">Phương Mint Store</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/don-hang">Đơn hàng của bạn</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/" id="donHangCuaBan"
                >Thêm đơn hàng mới</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <br />
    <div class="container-fluid bg-white-dusky">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <h2 class="text-center mb-4">Thông tin chốt đơn</h2>
          <!-- Form nhập thông tin -->
          <form method="post">
            <!-- Họ và tên -->
            <div class="mb-3">
              <label for="hoTen" class="form-label">Họ và tên</label>
              <input
                type="text"
                class="form-control"
                id="hoTen"
                name="fullName"
                required
                placeholder="Nhập họ và tên"
              />
            </div>
            <!-- Số điện thoại -->
            <div class="mb-3">
              <label for="soDienThoai" class="form-label">Số điện thoại</label>
              <input
                type="tel"
                class="form-control"
                id="soDienThoai"
                name="phone"
                placeholder="Vui lòng nhập số điện..."
                required
              />
            </div>
            <div class="container mt-3">
              <div id="orderForm">
                <div class="row mb-3">
                  <div class="col-md-4 col-sm-4">
                    <label for="maDonHang" class="form-label"
                      >Mã đơn hàng</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      name="code[]"
                      placeholder="Mã đơn hàng vd: 123"
                      required
                    />
                  </div>
                  <div class="col-md-4 col-sm-4">
                    <label for="soLuong" class="form-label">Số lượng</label>
                    <input
                      type="number"
                      class="form-control quantity"
                      name="quantity[]"
                      placeholder="Nhập số lượng"
                      value="1"
                      required
                    />
                  </div>
                  <div class="col-md-4 col-sm-4">
                    <label for="size" class="form-label">Size</label>
                    <select class="form-select" name="size[]" required>
                      <option value="">Chọn kích thước</option>
                      <option value="S">S</option>
                      <option value="M">M</option>
                      <option value="L">L</option>
                      <option value="XL">XL</option>
                    </select>
                  </div>
                </div>
              </div>

              <button
                type="button"
                class="btn btn-primary"
                onclick="addOrderItem()"
              >
                Thêm mã đơn hàng
              </button>
            </div>
            <br />
            <!-- Ghi chú -->
            <div class="mb-3">
              <label for="ghiChu" class="form-label">Ghi chú</label>
              <textarea
                class="form-control"
                id="ghiChu"
                name="note"
                rows="3"
              ></textarea>
            </div>
            <div>
              <label for="maDonHang" class="form-label">Tỉnh/Thành phố</label>
              <select
                class="form-select form-select-sm mb-3"
                id="city"
                aria-label=".form-select-sm"
                required
                name="city"
              >
                <option value="" selected>Chọn tỉnh thành</option>
              </select>
              <label for="maDonHang" class="form-label">Quận/Huyện</label>
              <select
                class="form-select form-control form-select-sm mb-3"
                id="district"
                aria-label=".form-select-sm"
                name="district"
                required
              >
                <option value="" selected>Chọn quận huyện</option>
              </select>
              <label for="maDonHang" class="form-label">Phường/Xã</label>
              <select
                class="form-select form-select-sm"
                id="ward"
                name="ward"
                aria-label=".form-select-sm"
                required
              >
                <option value="" selected>Chọn phường xã</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="maDonHang" class="form-label">Địa chỉ chi tiết</label>
              <input
                type="text"
                class="form-control"
                name="addressDetail"
                id="addressDetail"
                placeholder="Số nhà, thôn ấp, xã..."
                required
              />
            </div>
            <!-- Nút gửi thông tin -->
            <button type="submit" class="btn btn-block btn-danger">
              Mua Hàng Ngay
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Link thư viện Bootstrap JS (để sử dụng các tính năng của Bootstrap) -->

    <!-- Link tới Bootstrap JS và jQuery (cần Internet để load Bootstrap và jQuery) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
      function addOrderItem() {
        const orderItem = `
          <div class="row mb-3">
              <div class="col-md-4">
                  <label for="maDonHang" class="form-label">Mã đơn hàng</label>
                  <input type="text" class="form-control" name="code[]" placeholder="Mã đơn hàng vd: 123,345,..." required>
              </div>
              <div class="col-md-4">
                  <label for="soLuong" class="form-label">Số lượng</label>
                  <input type="number" class="form-control quantity" name="quantity[]" placeholder="Nhập số lượng" value="1" required>
              </div>
              <div class="col-md-4">
                  <label for="size" class="form-label">Size</label>
                  <select class="form-select" name="size[]" required>
                      <option value="">Chọn kích thước</option>
                      <option value="S">S</option>
                      <option value="M">M</option>
                      <option value="L">L</option>
                      <option value="XL">XL</option>
                  </select>
              </div>
          </div>
          `;
        $("#orderForm").append(orderItem);
      }
    </script>
    <script>
      var citis = document.getElementById("city");
      var districts = document.getElementById("district");
      var wards = document.getElementById("ward");
      var Parameter = {
        url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
        method: "GET",
        responseType: "application/json",
      };
      var promise = axios(Parameter);
      promise.then(function (result) {
        renderCity(result.data);
      });

      function renderCity(data) {
        for (const x of data) {
          citis.options[citis.options.length] = new Option(x.Name, x.Id);
        }
        citis.onchange = function () {
          district.length = 1;
          ward.length = 1;
          if (this.value != "") {
            const result = data.filter((n) => n.Id === this.value);

            for (const k of result[0].Districts) {
              district.options[district.options.length] = new Option(
                k.Name,
                k.Id
              );
            }
          }
        };
        district.onchange = function () {
          ward.length = 1;
          const dataCity = data.filter((n) => n.Id === citis.value);
          if (this.value != "") {
            const dataWards = dataCity[0].Districts.filter(
              (n) => n.Id === this.value
            )[0].Wards;

            for (const w of dataWards) {
              wards.options[wards.options.length] = new Option(w.Name, w.Id);
            }
          }
        };
      }
    </script>
    <script>
      // Bắt sự kiện khi click vào liên kết "Đơn hàng của bạn"
      document
        .getElementById("donHangCuaBan")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>

          // Hiển thị form nhập số điện thoại
          var contentDiv = document.getElementById("content");
          contentDiv.innerHTML = `
                <h2 class="text-center">Tìm đơn hàng của bạn</h2>
                <p class="text-center">Vui lòng nhập số điện thoại để tìm đơn hàng đã đặt:</p>
                <form id="searchForm">
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="phoneNumber" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Tìm đơn hàng</button>
                </form>
            `;

          // Bắt sự kiện khi submit form
          document
            .getElementById("searchForm")
            .addEventListener("submit", function (event) {
              event.preventDefault(); // Ngăn chặn hành động mặc định của form

              // Lấy giá trị số điện thoại từ input
              var phoneNumber = document.getElementById("phoneNumber").value;

              // Xử lý tìm đơn hàng (ở đây là một ví dụ)
              alert("Đang tìm đơn hàng cho số điện thoại: " + phoneNumber);
              // Tùy chỉnh xử lý tìm đơn hàng của bạn tại đây (gửi yêu cầu đến server, xử lý dữ liệu, ...)
            });
        });
    </script>
    <script>
      const phoneNumberInput = document.getElementById("soDienThoai");
      const fullNameInput = document.getElementById("hoTen");
      const cityInput = document.getElementById("city");
      const wardInput = document.getElementById("ward");
      const districtInput = document.getElementById("district");
      const addressInput = document.getElementById("addressDetail");

      phoneNumberInput.addEventListener("input", async () => {
        const phoneNumber = phoneNumberInput.value;

        try {
          const response = await fetch(
            "http://localhost:3000/get-user-by-phone",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ phone: phoneNumber }),
            }
          );

          const data = await response.json();

          if (data) {
            const {
              fullName,
              city,
              ward,
              district,
              addressDetail,
              districtName,
            } = data;

            fullNameInput.value = fullName || "";
            addressInput.value = addressDetail || "";
          } else {
            console.log("Không tìm thấy thông tin khách hàng");
            // Xử lý khi không tìm thấy thông tin khách hàng
          }
        } catch (error) {
          console.error("Lỗi khi gọi API:", error);
          // Xử lý lỗi khi gọi API
        }
      });
    </script>
  </body>
</html>
